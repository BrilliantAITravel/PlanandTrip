<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brilliant AI Travel & Expedition Website v5.0</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for the 'Inter' typeface -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujTnHg4C+Q5sXw/lqYyB6k5f9i5F/g+5d+u1Q6K9w5cK/T6LwL/y+QfL/Q5L/y/vQ5f8Q6Ew==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #0d1117; /* Dark background color to match the theme */
        }

        /* Custom animation keyframes for a smoother feel */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .animate-fade-in-up-delay-1 {
            animation: fadeInUp 0.6s ease-out 0.2s forwards;
            opacity: 0;
        }
        .animate-fade-in-up-delay-2 {
            animation: fadeInUp 0.6s ease-out 0.4s forwards;
            opacity: 0;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out forwards;
        }

        /* Utility for max-height on scrollable modal content */
        .modal-content-scroll {
            max-height: calc(90vh - 4rem);
        }

        /* Hide content that is not active */
        .hidden-content {
            display: none;
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #00d0cd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Markdown-like styling for itinerary */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }
        .markdown-content h1 { font-size: 2.25rem; }
        .markdown-content h2 { font-size: 1.75rem; }
        .markdown-content h3 { font-size: 1.5rem; }
        .markdown-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .markdown-content ul, .markdown-content ol {
            list-style-type: disc;
            padding-left: 2rem;
            margin-bottom: 1rem;
        }
        .markdown-content li {
            margin-bottom: 0.5rem;
        }

        /* Video Background Styling */
        #video-background {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            transform: translateX(-50%) translateY(-50%);
            background-size: cover;
        }

        /* Overlay to make text readable */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -99;
        }

        /* Styling for the form, input fields, etc. */
        .form-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .form-section h3 {
            font-weight: bold;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: #00d0cd;
        }
        .form-field-group {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        .form-input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: white;
        }
        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #3b424e;
            background-color: #191c21;
            color: #f8f9fa;
        }
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #00d0cd;
            box-shadow: 0 0 0 2px rgba(0, 208, 205, 0.2);
        }
        .form-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .form-checkbox {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #5a6674;
            border-radius: 0.25rem;
            background-color: #191c21;
            cursor: pointer;
            position: relative;
            margin-right: 0.5rem;
        }
        .form-checkbox:checked {
            background-color: #00d0cd;
            border-color: #00d0cd;
        }
        .form-checkbox:checked::before {
            content: '\f00c'; /* Font Awesome check icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: #191c21;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.75rem;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Main Container -->
    <div id="app-container" class="relative z-10 min-h-screen flex flex-col items-center">

        <!-- Video Background with Overlay -->
        <div class="video-overlay"></div>
        <video id="video-background" autoplay muted loop playsinline>
            <!-- Placeholder video from a royalty-free source like Pexels -->
            <source src="video/bgvideo.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <!-- Header -->
        <header class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-20">
            <div class="flex items-center space-x-2 cursor-pointer transition-colors duration-300">
                <div class="text-3xl font-extrabold text-[#00d0cd]">Brilliant AI</div>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-action="home">Home</a>
                <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="about">About Us</button>
                <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="contact">Contact</button>
            </nav>
            <div class="md:hidden">
                <button id="menu-btn" class="text-white hover:text-[#00d0cd]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden absolute top-16 right-6 bg-gray-900/60 rounded-lg shadow-xl p-4 md:hidden z-30">
                <nav class="flex flex-col space-y-2">
                    <a href="#" class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-action="home">Home</a>
                    <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="about">About Us</button>
                    <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="contact">Contact</button>
                </nav>
            </div>
        </header>

        <!-- Main Content (Hero/Categories/Subsections) -->
        <main id="main-content" class="text-center flex-grow flex flex-col justify-center items-center px-4 pt-20 pb-12 w-full"></main>

    </div>

    <!-- Modals will be injected here by JavaScript -->
    <div id="modal-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- State Management and Data ---
            let state = {
                showFormModal: false,
                showAboutModal: false,
                showContactModal: false,
                showItineraryModal: false,
                isGenerating: false,
                generatedItinerary: null,
                activeCategory: null,
                activeSubSection: null,
                aboutSection: 'introduction',
                formData: {
                    fullName: '', email: '', phone: '', preferredCommunication: [],
                    sourceCity: '', destinationType: 'single', destination: '',
                    travelDates: { startDate: '', endDate: '', flexibleDates: '' },
                    travelers: { adults: 1, childrenAges: '', infants: 0 },
                    travelingWith: [], travelingWithOther: '', travelPace: '', budget: '',
                    accommodationPreferences: [], specificAmenities: '', diningExperiences: [], dietaryRestrictions: '',
                    primaryInterests: [], primaryInterestsOther: '', mustSee: '', avoid: '',
                    preferredTourStyle: '', localInteraction: '', accessibilityNeeds: '', otherInfo: '',
                    howDidYouHear: '', howDidYouHearOther: ''
                },
                initialFormData: {
                    fullName: '', email: '', phone: '', preferredCommunication: [],
                    sourceCity: '', destinationType: 'single', destination: '',
                    travelDates: { startDate: '', endDate: '', flexibleDates: '' },
                    travelers: { adults: 1, childrenAges: '', infants: 0 },
                    travelingWith: [], travelingWithOther: '', travelPace: '', budget: '',
                    accommodationPreferences: [], specificAmenities: '', diningExperiences: [], dietaryRestrictions: '',
                    primaryInterests: [], primaryInterestsOther: '', mustSee: '', avoid: '',
                    preferredTourStyle: '', localInteraction: '', accessibilityNeeds: '', otherInfo: '',
                    howDidYouHear: '', howDidYouHearOther: ''
                }
            };

            const travelData = {
                family: {
                    title: "Family Travel Plans",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=India+Family+Trip", link: "#", title: "Jaipur Adventure" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Kerala+Backwaters", link: "#", title: "Kerala Backwaters" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Goa+Beaches", link: "#", title: "Goa Beaches" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Maldives+Family", link: "#", title: "Maldives Getaway" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Thailand+Islands", link: "#", title: "Thailand Islands" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Paris+with+Kids", link: "#", title: "Parisian Magic" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Swiss+Alps", link: "#", title: "Swiss Alps" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Iceland+Family", link: "#", title: "Iceland Adventure" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Florida+Family", link: "#", title: "Florida Fun" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Canadian+Rockies", link: "#", title: "Canadian Rockies" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Australia+Adventure", link: "#", title: "Australian Outback" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Egypt+Pyramids", link: "#", title: "Egyptian Pyramids" }
                        ]
                    }
                },
                solo: {
                    title: "Solo Travel Plans",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Goa+Solo", link: "#", title: "Goa Solo Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Ladakh+Himalayas", link: "#", title: "Ladakh Adventure" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Nepal+Trek", link: "#", title: "Nepal Trek" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Vietnam+Explore", link: "#", title: "Vietnam Exploration" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Italian+Coast", link: "#", title: "Italian Coast" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Iceland+Roadtrip", link: "#", title: "Iceland Roadtrip" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Peruvian+Hike", link: "#", title: "Peruvian Hike" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Mexico+City", link: "#", title: "Mexico City" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Japan+Solo", link: "#", title: "Japanese Culture" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=New+Zealand+Hike", link: "#", title: "New Zealand Hike" }
                        ]
                    }
                },
                friends: {
                    title: "Travel with Friends",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Ladakh+Trip", link: "#", title: "Ladakh Bike Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Rishikesh+Rafting", link: "#", title: "Rishikesh Rafting" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Bali+Friends", link: "#", title: "Bali Group Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Singapore+Fun", link: "#", title: "Singapore City Tour" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Eurotrip", link: "#", title: "European Road Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Greek+Islands", link: "#", title: "Greek Island Hopping" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Vegas+Party", link: "#", title: "Las Vegas Fun" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=NYC+Explore", link: "#", title: "New York City" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Bora+Bora", link: "#", title: "Bora Bora Retreat" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=South+Africa", link: "#", title: "South African Safari" }
                        ]
                    }
                }
            };

            const aboutSections = {
                introduction: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Introduction to Company</h3>
                    <p class="mt-2 text-justify text-white">
                        The future of personalized experiences is here.
                        <br /><br />
                        We're building a world where your digital life companion truly understands you, anticipating needs and orchestrating perfect experiences securely. That's the vision driving Brilliant AI.
                        <br /><br />
                        We're pioneering Agentic AI to transform how you plan, experience, and share – from hyper-personalized travel with Plan&Trip, to secure content management with Plan & Post, and culturally nuanced wedding planning with Plan & Marry.
                        <br /><br />
                        We're not just building apps; we're building trust and enabling unparalleled convenience. Join us on this journey to redefine digital life.
                        <br /><br />
                        Learn more at website link: <a href="https://brilliantaitravelandexpedition.com/" target="_blank" class="text-[#00d0cd] hover:underline">https://brilliantaitravelandexpedition.com/</a>
                    </p>
                `,
                mission: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Our Mission</h3>
                    <p class="mt-2 text-justify text-white">
                        To empower modern travellers and lifestyle planners with hyper-personalized, seamless, and secure digital experiences, transforming the way they plan, experience, and share their travel journeys and life events. Our purpose is to make complex travel and event planning effortless, enjoyable, and uniquely tailored to each individual, leveraging cutting-edge AI.
                    </p>
                `,
                vision: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Our Vision</h3>
                    <p class="mt-2 text-justify text-white">
                        To create a future where every journey and life event is effortlessly unique, deeply enriching, and perfectly tailored through intelligent technology. We aim to serve hundreds of millions of travellers, significantly grow our market share, and lead the development of sustainable tourism, leaving a lasting legacy in the travel world.
                    </p>
                `
            };

            // --- DOM Elements ---
            const mainContent = document.getElementById('main-content');
            const modalContainer = document.getElementById('modal-container');
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            // --- Helper Functions ---

            // Function to generate a detailed prompt for the AI based on form data
            const createAIprompt = (formData) => {
                const {
                    fullName, email, sourceCity, destinationType, destination,
                    travelDates, travelers, travelingWith, travelPace, budget,
                    accommodationPreferences, specificAmenities, diningExperiences,
                    dietaryRestrictions, primaryInterests, mustSee, avoid,
                    preferredTourStyle, localInteraction, accessibilityNeeds, otherInfo
                } = formData;

                // Basic validation for key fields
                if (!destination || !travelDates.startDate || !travelDates.endDate) {
                    return "Please provide a destination, start date, and end date to create an itinerary.";
                }

                // Constructing the detailed prompt
                const prompt = `
                    You are a highly skilled AI travel agent. Create a detailed, multi-day travel itinerary based on the following user preferences. The itinerary should be well-structured, day-by-day, and include recommendations for activities, food, and accommodation. Use a friendly, enthusiastic tone.

                    --- User's Travel Preferences ---
                    * **Name:** ${fullName}
                    * **Traveling From:** ${sourceCity || 'Not specified'}
                    * **Destination:** ${destination} (${destinationType} trip)
                    * **Travel Dates:** From ${travelDates.startDate} to ${travelDates.endDate} ${travelDates.flexibleDates ? `(Flexible: ${travelDates.flexibleDates})` : ''}
                    * **Number of Travelers:** ${travelers.adults} Adults, ${travelers.childrenAges ? `${travelers.childrenAges} Children` : ''}, ${travelers.infants} Infants
                    * **Travel Group:** ${travelingWith.join(', ') || 'Not specified'}
                    * **Travel Pace:** ${travelPace || 'Not specified'}
                    * **Budget:** ${budget || 'Not specified'}
                    * **Accommodation:** ${accommodationPreferences.join(', ') || 'Not specified'}. Specific amenities: ${specificAmenities || 'None specified'}.
                    * **Dining:** ${diningExperiences.join(', ') || 'Not specified'}. Dietary restrictions: ${dietaryRestrictions || 'None specified'}.
                    * **Interests:** ${primaryInterests.join(', ') || 'Not specified'}. Must-see: ${mustSee || 'None specified'}. To avoid: ${avoid || 'None specified'}.
                    * **Tour Style:** ${preferredTourStyle || 'Not specified'}
                    * **Local Interaction:** ${localInteraction || 'Not a priority'}
                    * **Accessibility Needs:** ${accessibilityNeeds || 'None specified'}
                    * **Other Info:** ${otherInfo || 'None specified'}

                    --- Itinerary Generation Instructions ---
                    1. **Start with a warm introduction.**
                    2. **Break down the itinerary by day.** Each day should have a clear heading.
                    3. **For each day, suggest specific activities, landmarks, and experiences.** Provide a brief description of each.
                    4. **Include recommendations for restaurants or local eateries** for at least one meal per day.
                    5. **Suggest a type of accommodation** that fits the budget and preferences.
                    6. **Conclude with a friendly closing remark.**
                    7. Format the response using Markdown. Use headings, bold text, and bullet points to make it easy to read. Do not include any extra text before the start of the itinerary.
                `;
                return prompt;
            };

            const parseFormData = () => {
                const form = document.getElementById('trip-form');
                if (!form) return;

                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    if (key.includes('[]')) {
                        const baseKey = key.replace('[]', '');
                        if (!data[baseKey]) {
                            data[baseKey] = [];
                        }
                        data[baseKey].push(value);
                    } else if (key.includes('.')) {
                        const [parent, child] = key.split('.');
                        if (!data[parent]) {
                            data[parent] = {};
                        }
                        data[parent][child] = value;
                    } else {
                        data[key] = value;
                    }
                }
                // Handle checkboxes separately for a cleaner data structure
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    const name = checkbox.name.replace('[]', '');
                    if (!data[name]) data[name] = [];
                    if (checkbox.checked) {
                        data[name].push(checkbox.value);
                    }
                });

                // Correctly parse childrenAges
                if (data.travelers && data.travelers.childrenAges) {
                    data.travelers.childrenAges = data.travelers.childrenAges.split(',').map(age => age.trim());
                } else if (data.travelers) {
                    data.travelers.childrenAges = [];
                }

                // Handle other fields
                if (data.travelingWithOther && data.travelingWith.includes('Other')) {
                    data.travelingWith = data.travelingWith.filter(item => item !== 'Other');
                    data.travelingWith.push(data.travelingWithOther);
                }
                if (data.primaryInterestsOther && data.primaryInterests.includes('Other')) {
                    data.primaryInterests = data.primaryInterests.filter(item => item !== 'Other');
                    data.primaryInterests.push(data.primaryInterestsOther);
                }
                if (data.howDidYouHearOther && data.howDidYouHear.includes('Other')) {
                    data.howDidYouHear = data.howDidYouHear.filter(item => item !== 'Other');
                    data.howDidYouHear.push(data.howDidYouHearOther);
                }

                return data;
            };

            const handleFormSubmit = async (e) => {
                e.preventDefault();
                state.isGenerating = true;
                state.generatedItinerary = null; // Clear previous itinerary
                render();

                const formData = parseFormData();
                const prompt = createAIprompt(formData);

                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const payload = {
                        contents: [{ role: "user", parts: [{ text: prompt }] }]
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        state.generatedItinerary = result.candidates[0].content.parts[0].text;
                        state.isGenerating = false;
                        state.showFormModal = false;
                        state.showItineraryModal = true;
                        render();
                    } else {
                        console.error("Unexpected API response structure:", result);
                        state.generatedItinerary = "An error occurred while generating your itinerary. Please try again.";
                        state.isGenerating = false;
                        render();
                    }
                } catch (error) {
                    console.error("Error generating itinerary:", error);
                    state.generatedItinerary = "An error occurred while generating your itinerary. Please try again.";
                    state.isGenerating = false;
                    render();
                }
            };

            const htmlRenderer = {
                renderModal: (modalId, title, content, closeAction) => {
                    return `
                        <div id="${modalId}" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/70 backdrop-blur-sm animate-fade-in">
                            <div class="relative w-full max-w-4xl max-h-[90vh] bg-gray-800 rounded-2xl shadow-2xl p-6 text-white overflow-y-auto">
                                <div class="flex justify-between items-center pb-3 border-b border-gray-700 mb-4">
                                    <h2 class="text-3xl font-bold text-[#00d0cd]">${title}</h2>
                                    <button class="text-gray-400 hover:text-white transition-colors" data-action="${closeAction}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div class="modal-content-scroll overflow-y-auto pr-4">
                                    ${content}
                                </div>
                            </div>
                        </div>
                    `;
                },

                renderAboutModal: () => {
                    const content = `
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-8">
                            <!-- Sidebar -->
                            <div class="flex flex-col w-full md:w-1/4">
                                <button class="about-nav-btn p-3 rounded-lg text-left font-semibold hover:bg-gray-700 transition-colors ${state.aboutSection === 'introduction' ? 'bg-[#00d0cd] text-gray-900' : 'text-white'}" data-section="introduction">
                                    Introduction
                                </button>
                                <button class="about-nav-btn p-3 rounded-lg text-left font-semibold hover:bg-gray-700 transition-colors ${state.aboutSection === 'mission' ? 'bg-[#00d0cd] text-gray-900' : 'text-white'}" data-section="mission">
                                    Our Mission
                                </button>
                                <button class="about-nav-btn p-3 rounded-lg text-left font-semibold hover:bg-gray-700 transition-colors ${state.aboutSection === 'vision' ? 'bg-[#00d0cd] text-gray-900' : 'text-white'}" data-section="vision">
                                    Our Vision
                                </button>
                            </div>
                            <!-- Content -->
                            <div class="flex-1 p-4 md:p-6 bg-gray-700 rounded-xl shadow-inner">
                                ${aboutSections[state.aboutSection]}
                            </div>
                        </div>
                    `;
                    return htmlRenderer.renderModal('about-modal', 'About Brilliant AI', content, 'close-about');
                },

                renderContactModal: () => {
                    const content = `
                        <div class="text-center p-6">
                            <h3 class="text-3xl font-semibold text-[#00d0cd] mb-4">Get in Touch</h3>
                            <p class="text-lg text-white mb-6">We'd love to hear from you! Reach out to us through the following channels:</p>
                            <div class="space-y-4">
                                <div class="flex items-center justify-center space-x-3">
                                    <i class="fas fa-envelope text-[#00d0cd] text-2xl"></i>
                                    <a href="mailto:info@brilliantaitravelandexpedition.com" class="text-white hover:text-[#00d0cd] transition-colors text-lg">info@brilliantaitravelandexpedition.com</a>
                                </div>
                                <div class="flex items-center justify-center space-x-3">
                                    <i class="fas fa-phone-alt text-[#00d0cd] text-2xl"></i>
                                    <a href="tel:+1234567890" class="text-white hover:text-[#00d0cd] transition-colors text-lg">+91-9876543210</a>
                                </div>
                            </div>
                            <div class="mt-8">
                                <h4 class="text-2xl font-semibold text-[#00d0cd] mb-2">Follow Us</h4>
                                <div class="flex justify-center space-x-6">
                                    <a href="#" class="text-white hover:text-[#00d0cd] transition-colors"><i class="fab fa-facebook-f text-2xl"></i></a>
                                    <a href="#" class="text-white hover:text-[#00d0cd] transition-colors"><i class="fab fa-twitter text-2xl"></i></a>
                                    <a href="#" class="text-white hover:text-[#00d0cd] transition-colors"><i class="fab fa-instagram text-2xl"></i></a>
                                    <a href="#" class="text-white hover:text-[#00d0cd] transition-colors"><i class="fab fa-linkedin-in text-2xl"></i></a>
                                </div>
                            </div>
                        </div>
                    `;
                    return htmlRenderer.renderModal('contact-modal', 'Contact Us', content, 'close-contact');
                },

                renderFormModal: () => {
                    const content = `
                        <div class="bg-gray-800 rounded-2xl p-8">
                            <h2 class="text-4xl font-extrabold text-white text-center mb-8">Create Your Dream Itinerary</h2>
                            <form id="trip-form" class="space-y-8">
                                <!-- Personal Information -->
                                <section class="form-section">
                                    <h3 class="text-2xl">Personal Information</h3>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="fullName" class="form-input-label">Full Name</label>
                                            <input type="text" id="fullName" name="fullName" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="email" class="form-input-label">Email Address</label>
                                            <input type="email" id="email" name="email" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="phone" class="form-input-label">Phone Number</label>
                                            <input type="tel" id="phone" name="phone" class="form-input">
                                        </div>
                                        <div class="col-span-full">
                                            <label class="form-input-label">Preferred Communication Method</label>
                                            <div class="flex flex-wrap gap-4 mt-2">
                                                <label class="form-checkbox-label text-white"><input type="checkbox" name="preferredCommunication[]" value="Email" class="form-checkbox">Email</label>
                                                <label class="form-checkbox-label text-white"><input type="checkbox" name="preferredCommunication[]" value="Phone Call" class="form-checkbox">Phone Call</label>
                                                <label class="form-checkbox-label text-white"><input type="checkbox" name="preferredCommunication[]" value="WhatsApp" class="form-checkbox">WhatsApp</label>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <!-- Travel Details -->
                                <section class="form-section">
                                    <h3 class="text-2xl">Travel Details</h3>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="sourceCity" class="form-input-label">Source City/Country</label>
                                            <input type="text" id="sourceCity" name="sourceCity" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="destination" class="form-input-label">Destination (City, Country)</label>
                                            <input type="text" id="destination" name="destination" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="destinationType" class="form-input-label">Destination Type</label>
                                            <select id="destinationType" name="destinationType" class="form-input" required>
                                                <option value="single">Single City/Country</option>
                                                <option value="multi">Multi-city/country</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="travelDates.startDate" class="form-input-label">Start Date</label>
                                            <input type="date" id="travelDates.startDate" name="travelDates.startDate" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="travelDates.endDate" class="form-input-label">End Date</label>
                                            <input type="date" id="travelDates.endDate" name="travelDates.endDate" class="form-input" required>
                                        </div>
                                        <div>
                                            <label for="travelDates.flexibleDates" class="form-input-label">Flexible Dates?</label>
                                            <select id="travelDates.flexibleDates" name="travelDates.flexibleDates" class="form-input">
                                                <option value="">No</option>
                                                <option value="+- 3 days">Yes, +- 3 days</option>
                                                <option value="+- 7 days">Yes, +- 7 days</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="travelers.adults" class="form-input-label">Number of Adults</label>
                                            <input type="number" id="travelers.adults" name="travelers.adults" class="form-input" min="1" value="1" required>
                                        </div>
                                        <div>
                                            <label for="travelers.childrenAges" class="form-input-label">Ages of Children (comma-separated)</label>
                                            <input type="text" id="travelers.childrenAges" name="travelers.childrenAges" class="form-input" placeholder="e.g., 5, 8, 12">
                                        </div>
                                        <div>
                                            <label for="travelers.infants" class="form-input-label">Number of Infants (Under 2)</label>
                                            <input type="number" id="travelers.infants" name="travelers.infants" class="form-input" min="0" value="0">
                                        </div>
                                    </div>
                                    <div class="col-span-full">
                                        <label class="form-input-label">Traveling With</label>
                                        <div class="flex flex-wrap gap-4 mt-2">
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="travelingWith[]" value="Family" class="form-checkbox">Family</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="travelingWith[]" value="Friends" class="form-checkbox">Friends</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="travelingWith[]" value="Partner/Spouse" class="form-checkbox">Partner/Spouse</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="travelingWith[]" value="Solo" class="form-checkbox">Solo</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="travelingWith[]" value="Other" class="form-checkbox" id="traveling-with-other-checkbox">Other</label>
                                            <input type="text" id="traveling-with-other-input" name="travelingWithOther" class="form-input hidden flex-1 min-w-[150px]" placeholder="Specify other...">
                                        </div>
                                    </div>
                                </section>
                                <!-- Preferences -->
                                <section class="form-section">
                                    <h3 class="text-2xl">Preferences</h3>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="travelPace" class="form-input-label">Travel Pace</label>
                                            <select id="travelPace" name="travelPace" class="form-input">
                                                <option value="">Select...</option>
                                                <option value="Relaxed">Relaxed (slow, leisurely)</option>
                                                <option value="Moderate">Moderate (balance of activity and rest)</option>
                                                <option value="Fast-paced">Fast-paced (see as much as possible)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="budget" class="form-input-label">Budget Per Person</label>
                                            <select id="budget" name="budget" class="form-input">
                                                <option value="">Select...</option>
                                                <option value="Economy">Economy ($)</option>
                                                <option value="Mid-range">Mid-range ($$)</option>
                                                <option value="Luxury">Luxury ($$$)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-span-full">
                                        <label class="form-input-label">Accommodation Preferences</label>
                                        <div class="flex flex-wrap gap-4 mt-2">
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="accommodationPreferences[]" value="Hotel" class="form-checkbox">Hotel</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="accommodationPreferences[]" value="Resort" class="form-checkbox">Resort</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="accommodationPreferences[]" value="Villa" class="form-checkbox">Villa</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="accommodationPreferences[]" value="Apartment" class="form-checkbox">Apartment/Airbnb</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="accommodationPreferences[]" value="Boutique" class="form-checkbox">Boutique</label>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="specificAmenities" class="form-input-label">Specific Amenities</label>
                                        <input type="text" id="specificAmenities" name="specificAmenities" class="form-input" placeholder="e.g., swimming pool, gym, free breakfast">
                                    </div>
                                    <div class="col-span-full">
                                        <label class="form-input-label">Dining Experiences</label>
                                        <div class="flex flex-wrap gap-4 mt-2">
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="diningExperiences[]" value="Local Cuisine" class="form-checkbox">Local Cuisine</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="diningExperiences[]" value="Fine Dining" class="form-checkbox">Fine Dining</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="diningExperiences[]" value="Casual" class="form-checkbox">Casual</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="diningExperiences[]" value="Street Food" class="form-checkbox">Street Food</label>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="dietaryRestrictions" class="form-input-label">Dietary Restrictions</label>
                                        <input type="text" id="dietaryRestrictions" name="dietaryRestrictions" class="form-input" placeholder="e.g., vegetarian, gluten-free, dairy allergy">
                                    </div>
                                </section>
                                <!-- Activities & Interests -->
                                <section class="form-section">
                                    <h3 class="text-2xl">Activities & Interests</h3>
                                    <div class="col-span-full">
                                        <label class="form-input-label">Primary Interests</label>
                                        <div class="flex flex-wrap gap-4 mt-2">
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Adventure" class="form-checkbox">Adventure</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Culture & History" class="form-checkbox">Culture & History</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Nature" class="form-checkbox">Nature</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Relaxation" class="form-checkbox">Relaxation</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Food & Culinary" class="form-checkbox">Food & Culinary</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Shopping" class="form-checkbox">Shopping</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Nightlife" class="form-checkbox">Nightlife</label>
                                            <label class="form-checkbox-label text-white"><input type="checkbox" name="primaryInterests[]" value="Other" class="form-checkbox" id="primary-interests-other-checkbox">Other</label>
                                            <input type="text" id="primary-interests-other-input" name="primaryInterestsOther" class="form-input hidden flex-1 min-w-[150px]" placeholder="Specify other...">
                                        </div>
                                    </div>
                                    <div>
                                        <label for="mustSee" class="form-input-label">Must-See Attractions/Activities</label>
                                        <input type="text" id="mustSee" name="mustSee" class="form-input" placeholder="e.g., Eiffel Tower, Great Wall">
                                    </div>
                                    <div>
                                        <label for="avoid" class="form-input-label">Things to Avoid</label>
                                        <input type="text" id="avoid" name="avoid" class="form-input" placeholder="e.g., crowded places, long hikes">
                                    </div>
                                    <div class="form-field-group">
                                        <div>
                                            <label for="preferredTourStyle" class="form-input-label">Preferred Tour Style</label>
                                            <select id="preferredTourStyle" name="preferredTourStyle" class="form-input">
                                                <option value="">Select...</option>
                                                <option value="Guided Tours">Guided Tours</option>
                                                <option value="Independent Exploration">Independent Exploration</option>
                                                <option value="Mix of Both">Mix of Both</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="localInteraction" class="form-input-label">Level of Local Interaction</label>
                                            <select id="localInteraction" name="localInteraction" class="form-input">
                                                <option value="">Select...</option>
                                                <option value="High">High (local workshops, homestays)</option>
                                                <option value="Moderate">Moderate (local markets, a few meals)</option>
                                                <option value="Low">Low (minimal interaction)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="accessibilityNeeds" class="form-input-label">Accessibility Needs</label>
                                        <input type="text" id="accessibilityNeeds" name="accessibilityNeeds" class="form-input" placeholder="e.g., wheelchair access, limited mobility">
                                    </div>
                                    <div>
                                        <label for="otherInfo" class="form-input-label">Any Other Information</label>
                                        <textarea id="otherInfo" name="otherInfo" class="form-textarea" rows="3" placeholder="Tell us anything else that might be helpful."></textarea>
                                    </div>
                                </section>
                                <!-- How did you hear about us? -->
                                <section class="form-section">
                                    <h3 class="text-2xl">How did you hear about us?</h3>
                                    <div class="flex flex-wrap gap-4 mt-2">
                                        <label class="form-checkbox-label text-white"><input type="checkbox" name="howDidYouHear[]" value="Google Search" class="form-checkbox">Google Search</label>
                                        <label class="form-checkbox-label text-white"><input type="checkbox" name="howDidYouHear[]" value="Social Media" class="form-checkbox">Social Media</label>
                                        <label class="form-checkbox-label text-white"><input type="checkbox" name="howDidYouHear[]" value="Friend/Family" class="form-checkbox">Friend/Family</label>
                                        <label class="form-checkbox-label text-white"><input type="checkbox" name="howDidYouHear[]" value="Other" class="form-checkbox" id="how-did-you-hear-other-checkbox">Other</label>
                                        <input type="text" id="how-did-you-hear-other-input" name="howDidYouHearOther" class="form-input hidden flex-1 min-w-[150px]" placeholder="Specify other...">
                                    </div>
                                </section>

                                <div class="flex justify-center">
                                    <button type="submit" class="bg-[#00d0cd] text-gray-900 px-8 py-4 rounded-full font-extrabold text-lg shadow-2xl hover:bg-opacity-80 transition-colors duration-300 transform hover:scale-105 active:scale-100">
                                        Generate Itinerary
                                    </button>
                                </div>
                            </form>
                        </div>
                    `;
                    return htmlRenderer.renderModal('form-modal', 'Start Your Planning Journey', content, 'close-form');
                },

                renderItineraryModal: () => {
                    const content = `
                        <div class="markdown-content text-white">
                            ${state.isGenerating
                                ? `<div class="flex flex-col items-center justify-center p-8">
                                     <div class="loader mb-4"></div>
                                     <p class="text-xl font-semibold text-[#00d0cd]">Generating your personalized itinerary...</p>
                                   </div>`
                                : `
                                    <h2 class="text-3xl font-extrabold text-center text-[#00d0cd] mb-6">Your Personalized Itinerary</h2>
                                    ${htmlRenderer.renderMarkdown(state.generatedItinerary)}
                                  `
                            }
                        </div>
                    `;
                    return htmlRenderer.renderModal('itinerary-modal', 'Your Itinerary', content, 'close-itinerary');
                },

                renderHeroAndCategories: () => {
                    return `
                        <!-- Hero Section -->
                        <section class="text-center flex-grow flex flex-col justify-center items-center px-4 pt-20 pb-12 w-full">
                            <h1 class="text-5xl md:text-7xl font-black text-white mb-4 drop-shadow-lg animate-fade-in-up"> Your Journey, Reimagined by AI </h1>
                            <p class="text-xl md:text-2xl text-gray-200 max-w-3xl mx-auto drop-shadow-lg mb-8 animate-fade-in-up-delay-1"> Explore our hyper-personalized travel plans and itineraries. </p>
                            <button id="start-planning-btn" class="bg-[#00d0cd] text-gray-900 px-8 py-4 rounded-full font-extrabold text-lg shadow-2xl hover:bg-opacity-80 transition-colors duration-300 transform hover:scale-105 active:scale-100 animate-fade-in-up-delay-2"> Personalize your trip </button>
                        </section>
                        <!-- Content Section - Categories -->
                        <section id="category-section" class="w-full max-w-7xl px-4 py-16 transition-all duration-500 transform opacity-100 scale-100 bg-gray-900/60 text-white rounded-xl shadow-2xl mt-8">
                            <h2 class="text-4xl font-bold text-center mb-12 text-white"> Our AI-Curated Plans </h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div data-category="family" class="category-card p-6 rounded-xl shadow-lg bg-gray-800 text-center cursor-pointer hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 transform">
                                    <img src="https://placehold.co/100x100/38a169/ffffff?text=Family" alt="Family Travel" class="rounded-full mb-4 mx-auto" />
                                    <h3 class="text-2xl font-semibold">Family Travel</h3>
                                    <p class="mt-2 text-gray-400">Perfect getaways for the whole family.</p>
                                </div>
                                <div data-category="solo" class="category-card p-6 rounded-xl shadow-lg bg-gray-800 text-center cursor-pointer hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 transform">
                                    <img src="https://placehold.co/100x100/4c51bf/ffffff?text=Solo" alt="Solo Expeditions" class="rounded-full mb-4 mx-auto" />
                                    <h3 class="text-2xl font-semibold">Solo Expeditions</h3>
                                    <p class="mt-2 text-gray-400">Discover the world on your own terms.</p>
                                </div>
                                <div data-category="friends" class="category-card p-6 rounded-xl shadow-lg bg-gray-800 text-center cursor-pointer hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 transform">
                                    <img src="https://placehold.co/100x100/dd6b20/ffffff?text=Friends" alt="Trips with Friends" class="rounded-full mb-4 mx-auto" />
                                    <h3 class="text-2xl font-semibold">Trips with Friends</h3>
                                    <p class="mt-2 text-gray-400">Adventure and memories with your crew.</p>
                                </div>
                            </div>
                        </section>
                    `;
                },

                renderSubsections: () => {
                    const category = travelData[state.activeCategory];
                    const subsections = Object.keys(category.subSections);

                    return `
                        <!-- Sub-category Header -->
                        <div class="w-full max-w-7xl px-4 pt-16 pb-8 bg-gray-900/60 rounded-xl shadow-2xl mt-8 mb-8 text-white">
                            <button id="back-to-categories" class="flex items-center text-[#00d0cd] font-semibold mb-6 hover:text-white transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Back to Categories
                            </button>
                            <h2 class="text-4xl font-bold text-center mb-6">${category.title}</h2>
                            <div class="flex flex-wrap justify-center gap-4 mb-8">
                                ${subsections.map(sub => `
                                    <button class="sub-section-btn p-3 rounded-full text-center font-semibold transition-colors duration-300 ${state.activeSubSection === sub ? 'bg-[#00d0cd] text-gray-900' : 'bg-gray-700 text-white hover:bg-gray-600'}" data-subsection="${sub}">
                                        ${sub.charAt(0).toUpperCase() + sub.slice(1)}
                                    </button>
                                `).join('')}
                            </div>

                            <div class="text-center">
                                <button id="start-planning-btn-subsection" class="bg-[#00d0cd] text-gray-900 px-8 py-4 rounded-full font-extrabold text-lg shadow-2xl hover:bg-opacity-80 transition-colors duration-300 transform hover:scale-105 active:scale-100">
                                    Personalize your trip
                                </button>
                            </div>
                        </div>

                        <!-- Trip Cards -->
                        <section class="w-full max-w-7xl px-4 pb-16">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                ${state.activeSubSection
                                    ? category.subSections[state.activeSubSection].map(trip => `
                                        <a href="${trip.link}" class="bg-gray-800 rounded-xl shadow-lg overflow-hidden block hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 transform">
                                            <img src="${trip.image}" alt="${trip.title}" class="w-full h-48 object-cover">
                                            <div class="p-6">
                                                <h3 class="text-xl font-semibold text-white">${trip.title}</h3>
                                            </div>
                                        </a>
                                    `).join('')
                                    : ''
                                }
                            </div>
                        </section>
                    `;
                },

                // Simple Markdown renderer for the itinerary
                renderMarkdown: (markdown) => {
                    if (!markdown) return '';
                    let html = markdown
                        .replace(/### (.*)/g, '<h3>$1</h3>')
                        .replace(/## (.*)/g, '<h2>$1</h2>')
                        .replace(/# (.*)/g, '<h1>$1</h1>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/- (.*)/g, '<li>$1</li>');

                    // Wrap in ul tag
                    if (html.includes('<li>')) {
                        html = `<ul>${html}</ul>`;
                    }

                    return html;
                }
            };

            // Main rendering function that determines what to show
            const render = () => {
                // Clear the main content and modal container
                mainContent.innerHTML = '';
                modalContainer.innerHTML = '';

                if (state.activeCategory) {
                    mainContent.innerHTML = htmlRenderer.renderSubsections();
                } else {
                    mainContent.innerHTML = htmlRenderer.renderHeroAndCategories();
                }

                // Render active modals
                if (state.showFormModal) {
                    modalContainer.innerHTML += htmlRenderer.renderFormModal();
                }
                if (state.showAboutModal) {
                    modalContainer.innerHTML += htmlRenderer.renderAboutModal();
                }
                if (state.showContactModal) {
                    modalContainer.innerHTML += htmlRenderer.renderContactModal();
                }
                if (state.showItineraryModal) {
                    modalContainer.innerHTML += htmlRenderer.renderItineraryModal();
                }

                // --- Re-attach event listeners after each render ---
                attachEventListeners();
            };

            const attachEventListeners = () => {
                // Main nav links
                document.querySelectorAll('header nav a, header nav button').forEach(el => {
                    el.addEventListener('click', (e) => {
                        if (e.target.dataset.action === 'home') {
                            state.activeCategory = null;
                            state.activeSubSection = null;
                            render();
                        } else if (e.target.dataset.modal) {
                            const modalName = e.target.dataset.modal;
                            state.showFormModal = false;
                            state.showAboutModal = false;
                            state.showContactModal = false;
                            state.showItineraryModal = false;
                            state[`show${modalName.charAt(0).toUpperCase() + modalName.slice(1)}Modal`] = true;
                            render();
                        }
                    });
                });

                // Mobile menu button
                const menuBtn = document.getElementById('menu-btn');
                const mobileMenu = document.getElementById('mobile-menu');
                if (menuBtn) {
                    menuBtn.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                    });
                }

                // Close modal buttons
                document.querySelectorAll('[data-action^="close-"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const modalToClose = e.target.closest('[data-action]').dataset.action.replace('close-', '');
                        const modalName = `show${modalToClose.charAt(0).toUpperCase() + modalToClose.slice(1)}Modal`;
                        state[modalName] = false;
                        render();
                    });
                });

                // About modal navigation
                document.querySelectorAll('.about-nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        state.aboutSection = e.target.dataset.section;
                        render();
                    });
                });

                // Start Planning button
                const startPlanningBtn = document.getElementById('start-planning-btn');
                if (startPlanningBtn) {
                    startPlanningBtn.addEventListener('click', () => {
                        state.showFormModal = true;
                        render();
                    });
                }

                const startPlanningBtnSubsection = document.getElementById('start-planning-btn-subsection');
                if (startPlanningBtnSubsection) {
                    startPlanningBtnSubsection.addEventListener('click', () => {
                        state.showFormModal = true;
                        render();
                    });
                }

                // Category card click listeners
                document.querySelectorAll('.category-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const category = e.currentTarget.dataset.category;
                        state.activeCategory = category;
                        state.activeSubSection = Object.keys(travelData[category].subSections)[0]; // Set default sub-section
                        render();
                    });
                });

                // Sub-section button click listeners
                document.querySelectorAll('.sub-section-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        state.activeSubSection = e.currentTarget.dataset.subsection;
                        render();
                    });
                });

                // Back to categories button
                const backToCategoriesBtn = document.getElementById('back-to-categories');
                if (backToCategoriesBtn) {
                    backToCategoriesBtn.addEventListener('click', () => {
                        state.activeCategory = null;
                        state.activeSubSection = null;
                        render();
                    });
                }

                // Handle form submission
                const tripForm = document.getElementById('trip-form');
                if (tripForm) {
                    tripForm.addEventListener('submit', handleFormSubmit);
                }

                // Handle "Other" checkbox for travelingWith
                const travelingWithOtherCheckbox = document.getElementById('traveling-with-other-checkbox');
                const travelingWithOtherInput = document.getElementById('traveling-with-other-input');
                if (travelingWithOtherCheckbox && travelingWithOtherInput) {
                    travelingWithOtherCheckbox.addEventListener('change', () => {
                        travelingWithOtherInput.classList.toggle('hidden', !travelingWithOtherCheckbox.checked);
                    });
                }
                
                // Handle "Other" checkbox for primaryInterests
                const primaryInterestsOtherCheckbox = document.getElementById('primary-interests-other-checkbox');
                const primaryInterestsOtherInput = document.getElementById('primary-interests-other-input');
                if (primaryInterestsOtherCheckbox && primaryInterestsOtherInput) {
                    primaryInterestsOtherCheckbox.addEventListener('change', () => {
                        primaryInterestsOtherInput.classList.toggle('hidden', !primaryInterestsOtherCheckbox.checked);
                    });
                }

                // Handle "Other" checkbox for howDidYouHear
                const howDidYouHearOtherCheckbox = document.getElementById('how-did-you-hear-other-checkbox');
                const howDidYouHearOtherInput = document.getElementById('how-did-you-hear-other-input');
                if (howDidYouHearOtherCheckbox && howDidYouHearOtherInput) {
                    howDidYouHearOtherCheckbox.addEventListener('change', () => {
                        howDidYouHearOtherInput.classList.toggle('hidden', !howDidYouHearOtherCheckbox.checked);
                    });
                }
            };

            // Initial render
            render();
        });
    </script>
</body>
</html>
