<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brilliant AI Travel & Expedition Website v3.3</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for the 'Inter' typeface -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Custom animation keyframes for a smoother feel */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .animate-fade-in-up-delay-1 {
            animation: fadeInUp 0.6s ease-out 0.2s forwards;
            opacity: 0;
        }
        .animate-fade-in-up-delay-2 {
            animation: fadeInUp 0.6s ease-out 0.4s forwards;
            opacity: 0;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out forwards;
        }
        
        /* Utility for max-height on scrollable modal content */
        .modal-content-scroll {
            max-height: calc(90vh - 4rem);
        }

        /* Hide content that is not active */
        .hidden-content {
            display: none;
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #00d0cd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Markdown-like styling for itinerary */
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: white; /* Changed text color for new background */
        }
        .markdown-content h1 { font-size: 2.25rem; }
        .markdown-content h2 { font-size: 1.75rem; }
        .markdown-content h3 { font-size: 1.5rem; }
        .markdown-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .markdown-content ul, .markdown-content ol {
            list-style-type: disc;
            padding-left: 2rem;
            margin-bottom: 1rem;
        }
        .markdown-content li {
            margin-bottom: 0.5rem;
        }

        /* Video Background Styling */
        #video-background {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            transform: translateX(-50%) translateY(-50%);
            background-size: cover;
        }
        
        /* Overlay to make text readable */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -99;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Main Container -->
    <div id="app-container" class="relative z-10 min-h-screen flex flex-col items-center">

        <!-- Video Background with Overlay -->
        <div class="video-overlay"></div>
        <video id="video-background" autoplay muted loop playsinline>
            <!-- Placeholder video from a royalty-free source like Pexels -->
            <source src="https://assets.mixkit.co/videos/preview/mixkit-small-waterfalls-in-the-mountains-28495-large.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <!-- Header -->
        <header class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-20">
            <div class="flex items-center space-x-2 cursor-pointer transition-colors duration-300">
                <div class="text-3xl font-extrabold text-[#00d0cd]">Brilliant AI</div>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-action="home">Home</a>
                <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="about">About Us</button>
                <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="contact">Contact</button>
            </nav>
            <div class="md:hidden">
                <button id="menu-btn" class="text-white hover:text-[#00d0cd]">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden absolute top-16 right-6 bg-gray-900/60 rounded-lg shadow-xl p-4 md:hidden z-30">
                <nav class="flex flex-col space-y-2">
                    <a href="#" class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-action="home">Home</a>
                    <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="about">About Us</button>
                    <button class="text-white font-semibold hover:text-[#00d0cd] transition-colors" data-modal="contact">Contact</button>
                </nav>
            </div>
        </header>

        <!-- Main Content (Hero/Categories/Subsections) -->
        <main id="main-content" class="text-center flex-grow flex flex-col justify-center items-center px-4 pt-20 pb-12 w-full"></main>

    </div>

    <!-- Modals will be injected here by JavaScript -->
    <div id="modal-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- State Management and Data ---
            let state = {
                showFormModal: false,
                showAboutModal: false,
                showContactModal: false,
                showItineraryModal: false,
                isGenerating: false,
                generatedItinerary: null,
                activeCategory: null,
                activeSubSection: null,
                aboutSection: 'introduction',
                formData: {
                    fullName: '', email: '', phone: '', preferredCommunication: [],
                    sourceCity: '', destinationType: 'single', destination: '',
                    travelDates: { startDate: '', endDate: '', flexibleDates: '' },
                    travelers: { adults: 1, childrenAges: '', infants: 0 },
                    travelingWith: [], travelingWithOther: '', travelPace: '', budget: '',
                    accommodationPreferences: [], specificAmenities: '', diningExperiences: [], dietaryRestrictions: '',
                    primaryInterests: [], primaryInterestsOther: '', mustSee: '', avoid: '',
                    preferredTourStyle: '', localInteraction: '', accessibilityNeeds: '', otherInfo: '',
                    howDidYouHear: '', howDidYouHearOther: ''
                },
                initialFormData: {
                    fullName: '', email: '', phone: '', preferredCommunication: [],
                    sourceCity: '', destinationType: 'single', destination: '',
                    travelDates: { startDate: '', endDate: '', flexibleDates: '' },
                    travelers: { adults: 1, childrenAges: '', infants: 0 },
                    travelingWith: [], travelingWithOther: '', travelPace: '', budget: '',
                    accommodationPreferences: [], specificAmenities: '', diningExperiences: [], dietaryRestrictions: '',
                    primaryInterests: [], primaryInterestsOther: '', mustSee: '', avoid: '',
                    preferredTourStyle: '', localInteraction: '', accessibilityNeeds: '', otherInfo: '',
                    howDidYouHear: '', howDidYouHearOther: ''
                }
            };
            
            const travelData = {
                family: {
                    title: "Family Travel Plans",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=India+Family+Trip", link: "#", title: "Jaipur Adventure" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Kerala+Backwaters", link: "#", title: "Kerala Backwaters" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Goa+Beaches", link: "#", title: "Goa Beaches" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Maldives+Family", link: "#", title: "Maldives Getaway" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Thailand+Islands", link: "#", title: "Thailand Islands" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Paris+with+Kids", link: "#", title: "Parisian Magic" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Swiss+Alps", link: "#", title: "Swiss Alps" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Iceland+Family", link: "#", title: "Iceland Adventure" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Florida+Family", link: "#", title: "Florida Fun" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Canadian+Rockies", link: "#", title: "Canadian Rockies" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Australia+Adventure", link: "#", title: "Australian Outback" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Egypt+Pyramids", link: "#", title: "Egyptian Pyramids" }
                        ]
                    }
                },
                solo: {
                    title: "Solo Travel Plans",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Goa+Solo", link: "#", title: "Goa Solo Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Ladakh+Himalayas", link: "#", title: "Ladakh Adventure" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Nepal+Trek", link: "#", title: "Nepal Trek" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Vietnam+Explore", link: "#", title: "Vietnam Exploration" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Italian+Coast", link: "#", title: "Italian Coast" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Iceland+Roadtrip", link: "#", title: "Iceland Roadtrip" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Peruvian+Hike", link: "#", title: "Peruvian Hike" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Mexico+City", link: "#", title: "Mexico City" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Japan+Solo", link: "#", title: "Japanese Culture" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=New+Zealand+Hike", link: "#", title: "New Zealand Hike" }
                        ]
                    }
                },
                friends: {
                    title: "Travel with Friends",
                    subSections: {
                        india: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Ladakh+Trip", link: "#", title: "Ladakh Bike Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Rishikesh+Rafting", link: "#", title: "Rishikesh Rafting" }
                        ],
                        southAsia: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Bali+Friends", link: "#", title: "Bali Group Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Singapore+Fun", link: "#", title: "Singapore City Tour" }
                        ],
                        europe: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Eurotrip", link: "#", title: "European Road Trip" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Greek+Islands", link: "#", title: "Greek Island Hopping" }
                        ],
                        america: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Vegas+Party", link: "#", title: "Las Vegas Fun" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=NYC+Explore", link: "#", title: "New York City" }
                        ],
                        others: [
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=Bora+Bora", link: "#", title: "Bora Bora Retreat" },
                            { image: "https://placehold.co/400x300/00d0cd/191970?text=South+Africa", link: "#", title: "South African Safari" }
                        ]
                    }
                }
            };

            const aboutSections = {
                introduction: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Introduction to Company</h3>
                    <p class="mt-2 text-justify text-white">
                        The future of personalized experiences is here.
                        <br /><br />
                        We're building a world where your digital life companion truly understands you, anticipating needs and orchestrating perfect experiences securely. That's the vision driving Brilliant AI.
                        <br /><br />
                        We're pioneering Agentic AI to transform how you plan, experience, and share â€“ from hyper-personalized travel with Plan&Trip, to secure content management with Plan & Post, and culturally nuanced wedding planning with Plan & Marry.
                        <br /><br />
                        We're not just building apps; we're building trust and enabling unparalleled convenience. Join us on this journey to redefine digital life.
                        <br /><br />
                        Learn more at website link: <a href="https://brilliantaitravelandexpedition.com/" target="_blank" class="text-[#00d0cd] hover:underline">https://brilliantaitravelandexpedition.com/</a>
                    </p>
                `,
                mission: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Our Mission</h3>
                    <p class="mt-2 text-justify text-white">
                        To empower modern travellers and lifestyle planners with hyper-personalized, seamless, and secure digital experiences, transforming the way they plan, experience, and share their travel journeys and life events. Our purpose is to make complex travel and event planning effortless, enjoyable, and uniquely tailored to each individual, leveraging cutting-edge AI.
                    </p>
                `,
                vision: `
                    <h3 class="text-2xl font-semibold text-[#00d0cd] text-center mb-2">Our Vision</h3>
                    <p class="mt-2 text-justify text-white">
                        To create a future where every journey and life event is effortlessly unique, deeply enriching, and perfectly tailored through intelligent technology. We aim to serve hundreds of millions of travellers, significantly grow our market share, and lead the development of sustainable tourism, leaving a lasting legacy in the travel world.
                    </p>
                `
            };

            // --- DOM Elements ---
            const mainContent = document.getElementById('main-content');
            const modalContainer = document.getElementById('modal-container');
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');

            // --- Helper Functions ---

            // Function to generate a detailed prompt for the AI based on form data
            const createAIprompt = (formData) => {
                const {
                    fullName, email, sourceCity, destinationType, destination,
                    travelDates, travelers, travelingWith, travelPace, budget,
                    accommodationPreferences, specificAmenities, diningExperiences,
                    dietaryRestrictions, primaryInterests, mustSee, avoid,
                    preferredTourStyle, localInteraction, accessibilityNeeds, otherInfo
                } = formData;

                // Basic validation for key fields
                if (!destination || !travelDates.startDate || !travelDates.endDate) {
                    return "Please provide a destination, start date, and end date to create an itinerary.";
                }

                // Constructing the detailed prompt
                const prompt = `
                    You are a highly skilled AI travel agent. Create a detailed, multi-day travel itinerary based on the following user preferences. The itinerary should be well-structured, day-by-day, and include recommendations for activities, food, and accommodation. Use a friendly, enthusiastic tone.

                    --- User's Travel Preferences ---
                    * **Name:** ${fullName}
                    * **Traveling From:** ${sourceCity || 'Not specified'}
                    * **Destination:** ${destination} (${destinationType} trip)
                    * **Travel Dates:** From ${travelDates.startDate} to ${travelDates.endDate} ${travelDates.flexibleDates ? `(Flexible: ${travelDates.flexibleDates})` : ''}
                    * **Number of Travelers:** ${travelers.adults} Adults, ${travelers.childrenAges ? `${travelers.childrenAges} Children` : ''}, ${travelers.infants} Infants
                    * **Travel Group:** ${travelingWith.join(', ') || 'Not specified'}
                    * **Travel Pace:** ${travelPace || 'Not specified'}
                    * **Budget:** ${budget || 'Not specified'}
                    * **Accommodation:** ${accommodationPreferences.join(', ') || 'Not specified'}. Specific amenities: ${specificAmenities || 'None specified'}.
                    * **Dining:** ${diningExperiences.join(', ') || 'Not specified'}. Dietary restrictions: ${dietaryRestrictions || 'None specified'}.
                    * **Interests:** ${primaryInterests.join(', ') || 'Not specified'}. Must-see: ${mustSee || 'None specified'}. To avoid: ${avoid || 'None specified'}.
                    * **Tour Style:** ${preferredTourStyle || 'Not specified'}
                    * **Local Interaction:** ${localInteraction || 'Not a priority'}
                    * **Accessibility Needs:** ${accessibilityNeeds || 'None specified'}
                    * **Other Info:** ${otherInfo || 'None specified'}

                    --- Itinerary Generation Instructions ---
                    1.  **Start with a warm introduction.**
                    2.  **Break down the itinerary by day.** Each day should have a clear heading.
                    3.  **For each day, suggest specific activities, landmarks, and experiences.** Provide a brief description of each.
                    4.  **Include recommendations for restaurants or local eateries** for at least one meal per day.
                    5.  **Suggest a type of accommodation** that fits the budget and preferences.
                    6.  **Conclude with a friendly closing remark.**
                    7.  Format the response using Markdown. Use headings, bold text, and bullet points to make it easy to read. Do not include any extra text before the start of the itinerary.
                `;
                return prompt;
            };

            // Main rendering function that determines what to show
            const render = () => {
                mainContent.innerHTML = '';
                
                if (state.activeCategory) {
                    renderSubsections();
                } else {
                    renderHeroAndCategories();
                }
                renderModals();
            };

            const renderHeroAndCategories = () => {
                mainContent.innerHTML = `
                    <!-- Hero Section -->
                    <section class="text-center flex-grow flex flex-col justify-center items-center px-4 pt-20 pb-12 w-full">
                        <h1 class="text-5xl md:text-7xl font-black text-white mb-4 drop-shadow-lg animate-fade-in-up">
                            Your Journey, Reimagined by AI
                        </h1>
                        <p class="text-xl md:text-2xl text-gray-200 max-w-3xl mx-auto drop-shadow-lg mb-8 animate-fade-in-up-delay-1">
                            Explore our hyper-personalized travel plans and itineraries.
                        </p>
                        <button id="start-planning-btn" class="bg-[#00d0cd] text-white px-8 py-4 rounded-full font-extrabold text-lg shadow-2xl hover:bg-opacity-80 transition-colors duration-300 transform hover:scale-105 active:scale-100 animate-fade-in-up-delay-2">
                            Start Planning
                        </button>
                    </section>

                    <!-- Content Section - Categories -->
                    <section id="category-section" class="w-full max-w-7xl px-4 py-16 transition-all duration-500 transform opacity-100 scale-100 bg-gray-900/60 text-white rounded-xl shadow-2xl mt-8">
                        <h2 class="text-4xl font-bold text-center mb-12 text-white">
                            Our AI-Curated Plans
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="group cursor-pointer rounded-xl overflow-hidden shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:-translate-y-2 bg-gray-800/80" data-category="family">
                                <img src="https://placehold.co/400x300/191970/00d0cd?text=Family+Travel" alt="Family Travel" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300 rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x300/191970/00d0cd?text=Family+Travel'" />
                                <div class="p-8">
                                    <h3 class="text-2xl font-bold text-white text-center capitalize">
                                        Family Travel Plans
                                    </h3>
                                </div>
                            </div>
                            <div class="group cursor-pointer rounded-xl overflow-hidden shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:-translate-y-2 bg-gray-800/80" data-category="solo">
                                <img src="https://placehold.co/400x300/191970/00d0cd?text=Solo+Travel" alt="Solo Travel" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300 rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x300/191970/00d0cd?text=Solo+Travel'" />
                                <div class="p-8">
                                    <h3 class="text-2xl font-bold text-white text-center capitalize">
                                        Solo Travel Plans
                                    </h3>
                                </div>
                            </div>
                            <div class="group cursor-pointer rounded-xl overflow-hidden shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:-translate-y-2 bg-gray-800/80" data-category="friends">
                                <img src="https://placehold.co/400x300/191970/00d0cd?text=Friends+Trip" alt="Travel with Friends" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300 rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x300/191970/00d0cd?text=Friends+Trip'" />
                                <div class="p-8">
                                    <h3 class="text-2xl font-bold text-white text-center capitalize">
                                        Travel with Friends
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </section>
                `;

                // Add event listeners for the hero section
                document.getElementById('start-planning-btn').addEventListener('click', () => {
                    state.showFormModal = true;
                    render();
                });

                // Add event listeners for categories using event delegation
                const categorySection = document.getElementById('category-section');
                categorySection.addEventListener('click', (e) => {
                    const categoryDiv = e.target.closest('[data-category]');
                    if (categoryDiv) {
                        state.activeCategory = categoryDiv.dataset.category;
                        state.activeSubSection = Object.keys(travelData[state.activeCategory].subSections)[0];
                        render();
                    }
                });
            };

            const renderSubsections = () => {
                const category = state.activeCategory;
                const subSections = travelData[category].subSections;
                const activeSubSectionData = subSections[state.activeSubSection] || [];

                mainContent.innerHTML = `
                    <section class="w-full max-w-7xl px-4 py-16 transition-all duration-500 transform opacity-100 scale-100 bg-gray-900/60 text-white rounded-xl shadow-2xl mt-8">
                        <button id="back-to-categories-btn" class="flex items-center text-white font-bold mb-8 hover:text-[#00d0cd] transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                            Back to Categories
                        </button>
                        <h2 class="text-4xl font-bold text-center mb-8 text-white">
                            ${travelData[category].title}
                        </h2>
                        <div id="sub-section-buttons" class="flex flex-wrap justify-center gap-4 mb-8">
                            ${Object.keys(subSections).map(subSection => `
                                <button class="px-6 py-2 rounded-full font-semibold transition-colors duration-200 capitalize
                                    ${state.activeSubSection === subSection ? 'bg-[#00d0cd] text-white shadow-md' : 'bg-gray-700 text-white hover:bg-gray-600'}"
                                    data-subsection="${subSection}">
                                    ${subSection.replace('southAsia', 'South Asia')}
                                </button>
                            `).join('')}
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
                            ${activeSubSectionData.map(plan => `
                                <a href="${plan.link}" class="group block rounded-xl overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 bg-gray-800/80">
                                    <img src="${plan.image}" alt="${plan.title}" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" 
                                    onerror="this.onerror=null;this.src='https://placehold.co/400x300/00d0cd/191970?text=${plan.title.replace(/\s/g, '+')}'" />
                                    <div class="p-4">
                                        <h3 class="text-xl font-semibold text-white">${plan.title}</h3>
                                    </div>
                                </a>
                            `).join('')}
                        </div>
                    </section>
                `;

                // Add event listeners for the subsection page
                document.getElementById('back-to-categories-btn').addEventListener('click', () => {
                    state.activeCategory = null;
                    state.activeSubSection = null;
                    render();
                });

                document.getElementById('sub-section-buttons').addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (button) {
                        state.activeSubSection = button.dataset.subsection;
                        render();
                    }
                });
            };

            const renderModals = () => {
                modalContainer.innerHTML = '';
                if (state.showFormModal) {
                    renderFormModal();
                } else if (state.showAboutModal) {
                    renderAboutModal();
                } else if (state.showContactModal) {
                    renderContactModal();
                } else if (state.showItineraryModal) {
                    renderItineraryModal();
                } else if (state.isGenerating) {
                    renderLoadingModal();
                }
            };
            
            const renderFormModal = () => {
                modalContainer.innerHTML = `
                    <div id="form-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-75 flex items-center justify-center p-4 overflow-y-auto animate-fade-in">
                        <div class="bg-gray-900/60 text-white rounded-lg shadow-2xl p-8 max-w-7xl w-full my-8 relative flex flex-col md:flex-row animate-fade-in-up">
                            <button id="close-form-btn" class="absolute top-4 right-4 text-white hover:text-gray-400 transition duration-200 z-50">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                            <!-- Left Menu Panel -->
                            <div id="form-nav" class="w-full md:w-1/3 flex-shrink-0 border-b md:border-b-0 md:border-r border-gray-700 pb-4 md:pr-8 md:pb-0">
                                <h2 class="text-3xl font-extrabold text-white mb-6">Personalize Your Trip</h2>
                                <nav class="space-y-4">
                                    <button class="w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors duration-200 bg-[#00d0cd] text-white shadow-md" data-section="contact">1. Your Contact Information</button>
                                    <button class="w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors duration-200 bg-transparent text-white hover:bg-gray-700" data-section="essentials">2. Trip Essentials</button>
                                    <button class="w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors duration-200 bg-transparent text-white hover:bg-gray-700" data-section="style">3. Your Travel Style & Preferences</button>
                                    <button class="w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors duration-200 bg-transparent text-white hover:bg-gray-700" data-section="interests">4. Your Interests & Desired Experiences</button>
                                </nav>
                            </div>
                            <!-- Right Form Content Panel -->
                            <div id="form-content" class="flex-grow pt-8 md:pt-0 md:pl-8 overflow-y-auto modal-content-scroll">
                                <form id="travel-form" class="space-y-8"></form>
                            </div>
                        </div>
                    </div>
                `;
                
                const formNav = document.getElementById('form-nav');
                const formContent = document.getElementById('form-content');
                const form = document.getElementById('travel-form');

                const renderFormSection = (sectionId) => {
                    let html = '';
                    switch (sectionId) {
                        case 'contact':
                            html = `
                                <section class="space-y-6">
                                    <h3 class="text-2xl font-bold text-white border-b-2 border-gray-700 pb-2">Your Contact Information</h3>
                                    <div class="flex flex-col"><label for="fullName" class="text-sm font-medium text-gray-200">Full Name</label><input type="text" id="fullName" name="fullName" value="${state.formData.fullName}" required class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>
                                    <div class="flex flex-col"><label for="email" class="text-sm font-medium text-gray-200">Email Address</label><input type="email" id="email" name="email" value="${state.formData.email}" required class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>
                                    <div class="flex flex-col"><label for="phone" class="text-sm font-medium text-gray-200">Phone Number (Optional)</label><input type="tel" id="phone" name="phone" value="${state.formData.phone}" placeholder="e.g., +1234567890" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Preferred Communication Method:</label><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                        ${['Email', 'Phone Call', 'WhatsApp'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="checkbox" name="preferredCommunication" value="${opt}" ${state.formData.preferredCommunication.includes(opt) ? 'checked' : ''} class="form-checkbox h-4 w-4 text-[#00d0cd] rounded focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                </section>`;
                            break;
                        case 'essentials':
                            html = `
                                <section class="space-y-6">
                                    <h3 class="text-2xl font-bold text-white border-b-2 border-gray-700 pb-2">Trip Essentials</h3>
                                    <div class="flex flex-col"><label for="sourceCity" class="text-sm font-medium text-gray-200">Source City</label><input type="text" id="sourceCity" name="sourceCity" value="${state.formData.sourceCity}" placeholder="e.g., Mumbai, India" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>
                                    <div class="space-y-4"><label class="text-sm font-medium text-gray-200 block">Desired Destination(s):</label><div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Trip Type</label><div class="flex flex-wrap gap-4">
                                        ${['single', 'multi-city'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="destinationType" value="${opt}" ${state.formData.destinationType === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div><div class="flex flex-col"><label for="destination" class="text-sm font-medium text-gray-200">Destination(s) - specify multiple if a ${state.formData.destinationType} trip</label><textarea id="destination" name="destination" rows="3" placeholder="e.g., Reykjavik, Iceland" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.destination}</textarea></div></div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="flex flex-col"><label for="startDate" class="text-sm font-medium text-gray-200">Start Date</label><input type="date" id="startDate" name="travelDates.startDate" value="${state.formData.travelDates.startDate}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div><div class="flex flex-col"><label for="endDate" class="text-sm font-medium text-gray-200">End Date</label><input type="date" id="endDate" name="travelDates.endDate" value="${state.formData.travelDates.endDate}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div></div>
                                    <div class="flex flex-col"><label for="flexibleDates" class="text-sm font-medium text-gray-200">If flexible, please indicate preferred month/season</label><input type="text" id="flexibleDates" name="travelDates.flexibleDates" value="${state.formData.travelDates.flexibleDates}" placeholder="e.g., Summer 2025" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="flex flex-col"><label for="adults" class="text-sm font-medium text-gray-200">Adults (18+)</label><input type="number" id="adults" name="travelers.adults" min="1" value="${state.formData.travelers.adults}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div><div class="flex flex-col"><label for="childrenAges" class="text-sm font-medium text-gray-200">Children (Ages)</label><input type="text" id="childrenAges" name="travelers.childrenAges" value="${state.formData.travelers.childrenAges}" placeholder="e.g., 6, 10, 14" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div><div class="flex flex-col"><label for="infants" class="text-sm font-medium text-gray-200">Infants (Under 2)</label><input type="number" id="infants" name="travelers.infants" min="0" value="${state.formData.travelers.infants}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div></div>
                                </section>`;
                            break;
                        case 'style':
                            html = `
                                <section class="space-y-6">
                                    <h3 class="text-2xl font-bold text-white border-b-2 border-gray-700 pb-2">Your Travel Style & Preferences</h3>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Who are you traveling with? (Select all that apply)</label><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                        ${['Solo', 'Partner/Spouse', 'Family with young children', 'Family with teenagers', 'Friends', 'Colleagues/Business Trip', 'Other'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="checkbox" name="travelingWith" value="${opt}" ${state.formData.travelingWith.includes(opt) ? 'checked' : ''} class="form-checkbox h-4 w-4 text-[#00d0cd] rounded focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    ${state.formData.travelingWith.includes('Other') ? `<div class="flex flex-col"><label for="travelingWithOther" class="text-sm font-medium text-gray-200">Please specify</label><input type="text" id="travelingWithOther" name="travelingWithOther" value="${state.formData.travelingWithOther}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>` : ''}
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">What is your preferred travel pace?</label><div class="flex flex-wrap gap-4">
                                        ${['Relaxed', 'Moderate', 'Active', 'Adventure-packed'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="travelPace" value="${opt}" ${state.formData.travelPace === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">What is your general budget comfort level? (per person, excluding flights)</label><div class="flex flex-wrap gap-4">
                                        ${['Budget-Conscious', 'Mid-Range', 'Upscale', 'Luxury', 'Flexible'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="budget" value="${opt}" ${state.formData.budget === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Accommodation Preferences: (Select all that apply)</label><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                        ${['Hotels', 'Boutique Hotels', 'Resorts', 'Vacation Rentals', 'Unique Stays', 'Hostels/Guesthouses'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="checkbox" name="accommodationPreferences" value="${opt}" ${state.formData.accommodationPreferences.includes(opt) ? 'checked' : ''} class="form-checkbox h-4 w-4 text-[#00d0cd] rounded focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="flex flex-col"><label for="specificAmenities" class="text-sm font-medium text-gray-200">Specific amenities (e.g., pool, gym, spa)</label><textarea id="specificAmenities" name="specificAmenities" rows="3" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.specificAmenities}</textarea></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Preferred Dining Experiences: (Select all that apply)</label><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                        ${['Fine Dining / Michelin Star', 'Local Cuisine / Street Food', 'Casual Restaurants / Cafes'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="checkbox" name="diningExperiences" value="${opt}" ${state.formData.diningExperiences.includes(opt) ? 'checked' : ''} class="form-checkbox h-4 w-4 text-[#00d0cd] rounded focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="flex flex-col"><label for="dietaryRestrictions" class="text-sm font-medium text-gray-200">Any Dietary Restrictions/Allergies?</label><textarea id="dietaryRestrictions" name="dietaryRestrictions" rows="3" placeholder="e.g., Vegetarian, Vegan, Halal, Gluten-Free, Kosher" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.dietaryRestrictions}</textarea></div>
                                </section>`;
                            break;
                        case 'interests':
                            html = `
                                <section class="space-y-6">
                                    <h3 class="text-2xl font-bold text-white border-b-2 border-gray-700 pb-2">Your Interests & Desired Experiences</h3>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">What are your primary interests for this trip? (Select all that apply)</label><div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                                        ${['Culture & History', 'Food & Drink', 'Nature & Outdoors', 'Adventure & Sports', 'Relaxation & Wellness', 'Art & Design', 'Shopping & Fashion', 'Nightlife & Entertainment', 'Family-Friendly Activities', 'Photography', 'Philanthropic/Volunteering opportunities', 'Other'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="checkbox" name="primaryInterests" value="${opt}" ${state.formData.primaryInterests.includes(opt) ? 'checked' : ''} class="form-checkbox h-4 w-4 text-[#00d0cd] rounded focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    ${state.formData.primaryInterests.includes('Other') ? `<div class="flex flex-col"><label for="primaryInterestsOther" class="text-sm font-medium text-gray-200">Please specify other interests</label><input type="text" id="primaryInterestsOther" name="primaryInterestsOther" value="${state.formData.primaryInterestsOther}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>` : ''}
                                    <div class="flex flex-col"><label for="mustSee" class="text-sm font-medium text-gray-200">Are there any specific 'must-see' landmarks, attractions, or activities?</label><textarea id="mustSee" name="mustSee" rows="3" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.mustSee}</textarea></div>
                                    <div class="flex flex-col"><label for="avoid" class="text-sm font-medium text-gray-200">Are there any activities, places, or experiences you absolutely want to AVOID?</label><textarea id="avoid" name="avoid" rows="3" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.avoid}</textarea></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">Do you prefer:</label><div class="flex flex-wrap gap-4">
                                        ${['Guided tours with a group', 'Private guided tours', 'Self-guided exploration', 'A mix of the above'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="preferredTourStyle" value="${opt}" ${state.formData.preferredTourStyle === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">How important is it to interact with locals and experience authentic culture?</label><div class="flex flex-wrap gap-4">
                                        ${['Very Important', 'Moderately Important', 'Not a priority'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="localInteraction" value="${opt}" ${state.formData.localInteraction === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    <div class="flex flex-col"><label for="accessibilityNeeds" class="text-sm font-medium text-gray-200">Any specific mobility or accessibility needs we should be aware of?</label><textarea id="accessibilityNeeds" name="accessibilityNeeds" rows="3" placeholder="e.g., wheelchair accessible, limited walking, quiet environments" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.accessibilityNeeds}</textarea></div>
                                    <div class="flex flex-col"><label for="otherInfo" class="text-sm font-medium text-gray-200">Is there anything else you'd like us to know?</label><textarea id="otherInfo" name="otherInfo" rows="3" placeholder="e.g., special occasions, desired atmosphere, unique requests" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white">${state.formData.otherInfo}</textarea></div>
                                    <div class="space-y-2"><label class="text-sm font-medium text-gray-200 block">How did you hear about Brilliant AI Plan&Trip?</label><div class="flex flex-wrap gap-4">
                                        ${['Social Media', 'Friend/Family Referral', 'Online Search', 'Article/Blog', 'Event/Conference', 'Other'].map(opt => `<label class="flex items-center space-x-2 text-sm text-gray-200"><input type="radio" name="howDidYouHear" value="${opt}" ${state.formData.howDidYouHear === opt ? 'checked' : ''} class="form-radio h-4 w-4 text-[#00d0cd] focus:ring-[#00d0cd]" /><span>${opt}</span></label>`).join('')}
                                    </div></div>
                                    ${state.formData.howDidYouHear === 'Social Media' || state.formData.howDidYouHear === 'Other' ? `<div class="flex flex-col"><label for="howDidYouHearOther" class="text-sm font-medium text-gray-200">Please specify</label><input type="text" id="howDidYouHearOther" name="howDidYouHearOther" value="${state.formData.howDidYouHearOther}" class="mt-1 p-3 border border-gray-700 rounded-md focus:ring-[#00d0cd] focus:border-[#00d0cd] transition bg-gray-800 text-white" /></div>` : ''}
                                    <div class="mt-8 text-center text-gray-400 text-sm italic">
                                        <p><strong>Privacy & Security Note:</strong> At Brilliant AI, your privacy and data security are paramount. The information you provide will be used solely for the purpose of crafting your personalized trip itinerary and enhancing your experience with our services, in accordance with our privacy policy.</p>
                                    </div>
                                </section>
                                <div class="mt-8 text-right">
                                    <button type="submit" id="submit-btn" class="px-8 py-4 bg-[#00d0cd] text-white font-extrabold rounded-full text-lg shadow-2xl hover:bg-opacity-80 transition-colors duration-300 transform hover:scale-105 active:scale-100">
                                        Submit & Plan Your Trip
                                    </button>
                                </div>
                            `;
                            break;
                    }
                    form.innerHTML = html;
                };

                const updateFormState = (e) => {
                    const { name, value, type, checked } = e.target;
                    
                    if (type === 'checkbox') {
                        const arr = state.formData[name] || [];
                        state.formData[name] = checked ? [...arr, value] : arr.filter(item => item !== value);
                    } else if (name.includes('.')) {
                        const [parent, child] = name.split('.');
                        state.formData[parent][child] = value;
                    } else {
                        state.formData[name] = value;
                    }

                    // This is a simple way to re-render the current form section after a change
                    const activeSectionBtn = formNav.querySelector('.bg-[#00d0cd]');
                    renderFormSection(activeSectionBtn.dataset.section);
                };

                formNav.addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (button) {
                        formNav.querySelectorAll('button').forEach(btn => {
                            btn.classList.remove('bg-[#00d0cd]', 'text-white', 'shadow-md');
                            btn.classList.add('bg-transparent', 'text-white', 'hover:bg-gray-700');
                        });
                        button.classList.add('bg-[#00d0cd]', 'text-white', 'shadow-md');
                        button.classList.remove('bg-transparent', 'text-white', 'hover:bg-gray-700');
                        renderFormSection(button.dataset.section);
                    }
                });

                form.addEventListener('change', updateFormState);
                
                form.addEventListener('submit', handleFormSubmission);
                
                document.getElementById('close-form-btn').addEventListener('click', () => {
                    state.showFormModal = false;
                    render();
                });

                renderFormSection('contact');
            };

            const renderLoadingModal = () => {
                modalContainer.innerHTML = `
                    <div id="loading-modal" class="fixed inset-0 z-[150] bg-black bg-opacity-75 flex items-center justify-center p-4 animate-fade-in">
                        <div class="bg-gray-900/60 p-8 rounded-lg shadow-xl text-center max-w-sm w-full">
                            <div class="flex justify-center items-center mb-4">
                                <div class="loader"></div>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-2">Generating Itinerary...</h3>
                            <p class="text-gray-200">Please wait while our AI crafts your personalized trip.</p>
                        </div>
                    </div>
                `;
            };

            const renderItineraryModal = () => {
                modalContainer.innerHTML = `
                    <div id="itinerary-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-75 flex items-center justify-center p-4 overflow-y-auto animate-fade-in">
                        <div class="bg-gray-900/60 rounded-lg shadow-2xl p-8 max-w-4xl w-full my-8 relative animate-fade-in-up">
                            <button id="close-itinerary-btn" class="absolute top-4 right-4 text-white hover:text-gray-400 transition duration-200 z-50">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                            <h2 class="text-3xl font-extrabold text-white mb-4 text-center">Your Custom AI Itinerary</h2>
                            <div id="itinerary-content" class="modal-content-scroll overflow-y-auto p-4 border rounded-md bg-gray-800/80 markdown-content text-white">
                                <!-- Itinerary content will be inserted here -->
                                ${marked.parse(state.generatedItinerary || 'Could not generate itinerary. Please try again.')}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('close-itinerary-btn').addEventListener('click', () => {
                    state.showItineraryModal = false;
                    render();
                });
            };

            const renderAboutModal = () => {
                modalContainer.innerHTML = `
                    <div id="about-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75 animate-fade-in">
                        <div class="bg-gray-900/60 text-white rounded-xl shadow-2xl p-8 mx-auto text-left relative flex flex-col md:flex-row overflow-hidden w-full max-w-7xl">
                            <button id="close-about-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors text-2xl">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                            <aside class="w-full md:w-1/4 flex-shrink-0 bg-gray-900 p-6 rounded-l-xl md:rounded-r-none overflow-y-auto border-r border-[#00d0cd]/20 md:border-b-0">
                                <h2 class="text-3xl font-bold mb-6 text-white">About Us</h2>
                                <nav id="about-nav" class="space-y-4">
                                    <button class="w-full text-left px-4 py-3 rounded-xl font-semibold transition-colors duration-200 hover:bg-white/20 ${state.aboutSection === 'introduction' ? 'bg-white text-[#191970]' : 'text-white'}" data-section="introduction">Introduction to Company</button>
                                    <button class="w-full text-left px-4 py-3 rounded-xl font-semibold transition-colors duration-200 hover:bg-white/20 ${state.aboutSection === 'mission' ? 'bg-white text-[#191970]' : 'text-white'}" data-section="mission">Our Mission</button>
                                    <button class="w-full text-left px-4 py-3 rounded-xl font-semibold transition-colors duration-200 hover:bg-white/20 ${state.aboutSection === 'vision' ? 'bg-white text-[#191970]' : 'text-white'}" data-section="vision">Our Vision</button>
                                </nav>
                            </aside>
                            <div id="about-content" class="flex-grow md:w-3/4 p-6 text-justify overflow-y-auto">
                                ${aboutSections[state.aboutSection]}
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('close-about-btn').addEventListener('click', () => {
                    state.showAboutModal = false;
                    render();
                });
                document.getElementById('about-nav').addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if (button) {
                        state.aboutSection = button.dataset.section;
                        render();
                    }
                });
            };

            const renderContactModal = () => {
                modalContainer.innerHTML = `
                    <div id="contact-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75 animate-fade-in">
                        <div class="bg-gray-900/60 text-white rounded-xl shadow-2xl p-8 mx-auto text-center relative max-w-lg w-full">
                            <button id="close-contact-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                            </button>
                            <h2 class="text-3xl font-bold mb-4 text-[#00d0cd]">Get in Touch</h2>
                            <p class="text-lg mb-6 text-gray-200">We'd love to hear from you!</p>
                            <div class="space-y-4">
                                <a href="mailto:info@brilliantaitravel.com" class="flex items-center justify-center px-6 py-3 bg-[#00d0cd] text-[#191970] rounded-full font-bold hover:bg-opacity-80 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                    </svg>
                                    Email Us
                                </a>
                                <a href="https://wa.me/918288834228" target="_blank" class="flex items-center justify-center px-6 py-3 bg-white text-[#191970] rounded-full font-bold hover:bg-gray-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M20.52 3.48A11.02 11.02 0 0012 1a11.02 11.02 0 00-8.52 3.48A11.02 11.02 0 001 12c0 2.22.61 4.31 1.74 6.1a10.96 10.96 0 00-1.63 2.92l3.05-.88a10.97 10.97 0 006.84 2.1c6.07 0 11-4.93 11-11s-4.93-11-11-11zm-4.7 13.62a3.84 3.84 0 01-2.92 1.3c-1.3 0-2.58-.6-3.46-1.74a8.21 8.21 0 01-1.74-3.46c0-1.3.56-2.5 1.74-3.46a3.28 3.28 0 014.28-.46c.9.68 1.48 1.74 1.48 2.92.01 1.18-.46 2.24-1.34 2.92zm-.8-3.92a.56.56 0 00-.7-.04c-.38.2-.82.3-1.3.3-1.62 0-2.94-1.32-2.94-2.94a2.94 2.94 0 013.92-2.42c.6.28 1.08.76 1.36 1.36a.56.56 0 00-.04.7.56.56 0 00.7.04z" stroke-linecap="round" stroke-linejoin="round" stroke-width="0"/></svg>
                                    WhatsApp
                                </a>
                                <a href="https://www.instagram.com/planandtrip_official/" target="_blank" class="flex items-center justify-center px-6 py-3 bg-white text-[#191970] rounded-full font-bold hover:bg-gray-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 1.9c1.983 0 2.227 0 2.94.043.68.04 1.045.143 1.25.247.33.16.55.38.71.71.1.205.207.57.247 1.25.043.713.043 2.957.043 4.94s0 4.227-.043 4.94c-.04.68-.147 1.045-.247 1.25-.16.33-.38.55-.71.71-.205.1-.57.207-1.25.247-.713.043-2.957.043-4.94.043s-4.227 0-4.94-.043c-.68-.04-1.045-.147-1.25-.247-.33-.16-.55-.38-.71-.71-.1-.205-.207-.57-.247-1.25-.043-.713-.043-2.957-.043-4.94s0-4.227.043-4.94c.04-.68.147-1.045.247-1.25.16-.33.38-.55.71-.71.205-.1.57-.207 1.25-.247C9.773 3.9 10.017 3.9 12 3.9zm0 2.1a6 6 0 100 12 6 6 0 000-12zm0 2a4 4 0 110 8 4 4 0 010-8zm0 2a2 2 0 100 4 2 2 0 000-4zm6.5-5.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z" stroke-linecap="round" stroke-linejoin="round" stroke-width="0"/></svg>
                                    Instagram
                                </a>
                                <a href="https://www.facebook.com/people/Planandtrip/61574923184872/" target="_blank" class="flex items-center justify-center px-6 py-3 bg-white text-[#191970] rounded-full font-bold hover:bg-gray-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm3 8.5h-2v-2a1 1 0 011-1h1v-2h-2a4 4 0 00-4 4v2h-2v2h2v6h3v-6h2l1-2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="0"/></svg>
                                    Facebook
                                </a>
                                <a href="https://www.linkedin.com/in/brilliant-ai-travel-and-expedetion/" target="_blank" class="flex items-center justify-center px-6 py-3 bg-white text-[#191970] rounded-full font-bold hover:bg-gray-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                    <path d="M21 0H3C1.346 0 0 1.346 0 3v18c0 1.654 1.346 3 3 3h18c1.654 0 3-1.346 3-3V3c0-1.654-1.346-3-3-3zM9 18H6v-9h3v9zm-1.5-9.7a1.8 1.8 0 110-3.6 1.8 1.8 0 010 3.6zm13.5 9.7h-3v-5.6c0-1.025-.018-2.348-1.428-2.348-1.43 0-1.65 1.118-1.65 2.278V18h-3v-9h2.89v1.365h.04c.4-.766 1.378-1.574 2.855-1.574 3.056 0 3.62 2.012 3.62 4.62V18h-.007z" stroke-linecap="round" stroke-linejoin="round" stroke-width="0"/></svg>
                                    LinkedIn
                                </a>
                                <a href="https://brilliantaitravelandexpedition.com/" target="_blank" class="flex items-center justify-center px-6 py-3 bg-white text-[#191970] rounded-full font-bold hover:bg-gray-200 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" stroke-linecap="round" stroke-linejoin="round" stroke-width="0"/></svg>
                                    Website
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('close-contact-btn').addEventListener('click', () => {
                    state.showContactModal = false;
                    render();
                });
            };

            const handleFormSubmission = async (e) => {
                e.preventDefault();
                
                // Close the form modal and show the loading screen
                state.showFormModal = false;
                state.isGenerating = true;
                render();

                // Construct the prompt for the AI
                const prompt = createAIprompt(state.formData);
                console.log("Sending prompt to AI:", prompt);

                // API call to the Gemini model
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                let retryCount = 0;
                const maxRetries = 5;
                const baseDelay = 1000;

                while (retryCount < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            const delay = baseDelay * Math.pow(2, retryCount);
                            console.log(`Rate limit hit. Retrying in ${delay}ms...`);
                            await new Promise(res => setTimeout(res, delay));
                            retryCount++;
                            continue;
                        }

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const generatedText = result.candidates[0].content.parts[0].text;
                            state.generatedItinerary = generatedText;
                            state.isGenerating = false;
                            state.showItineraryModal = true;
                            state.formData = { ...state.initialFormData }; // Reset form data
                            render();
                            return;
                        } else {
                            throw new Error("Invalid response structure from API.");
                        }

                    } catch (error) {
                        console.error('Error generating itinerary:', error);
                        state.isGenerating = false;
                        state.generatedItinerary = `Failed to generate an itinerary. Please check the console for errors and try again. Error: ${error.message}`;
                        state.showItineraryModal = true;
                        render();
                        return;
                    }
                }
                
                // If max retries are reached
                console.error('Max retries reached. Failed to fetch from API.');
                state.isGenerating = false;
                state.generatedItinerary = "Failed to generate an itinerary due to repeated API errors. Please try again later.";
                state.showItineraryModal = true;
                render();
            };

            // Simple Markdown parser for the generated itinerary
            const marked = {
                parse: function(markdownText) {
                    // This is a very basic, custom markdown parser.
                    let html = markdownText
                        // Convert headings to h1, h2, h3
                        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                        // Convert bold text
                        .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                        // Convert bullet points to ul
                        .replace(/^\* (.*$)/gim, '<li>$1</li>')
                        // Convert to paragraphs for blocks of text
                        .split('\n\n').map(p => {
                            if (!p.startsWith('<h') && !p.startsWith('<li>')) {
                                return `<p>${p.replace(/\n/g, '<br>')}</p>`;
                            }
                            return p;
                        }).join('');

                    // Wrap list items in a ul tag
                    if (html.includes('<li>')) {
                        html = `<ul>${html}</ul>`;
                    }

                    return html;
                }
            };
            
            // --- Event Listeners and Initial Render ---

            // Main nav links
            document.querySelectorAll('header nav a, header nav button').forEach(el => {
                el.addEventListener('click', (e) => {
                    if (e.target.dataset.action === 'home') {
                        state.activeCategory = null;
                        state.activeSubSection = null;
                        render();
                    } else if (e.target.dataset.modal) {
                        const modalName = e.target.dataset.modal;
                        state.showFormModal = false;
                        state.showAboutModal = false;
                        state.showContactModal = false;
                        state.showItineraryModal = false;
                        state[`show${modalName.charAt(0).toUpperCase() + modalName.slice(1)}Modal`] = true;
                        render();
                    }
                });
            });

            // Mobile menu button
            menuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            // Initial render
            render();
        });
    </script>
</body>
</html>
